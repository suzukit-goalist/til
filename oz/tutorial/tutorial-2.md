# ローカル環境でOZを動かす

## 前提条件

* SVNアカウント作成を作成済みであること
 
  未作成の場合は、入倉さんか盛次さんに作成を依頼する

* eclipseをインストール済みであること


## 開発環境作成

### ソースコードのチェックアウト

1. SVNリポジトリに接続するため、VPN接続にする(ローカルPCにパブリックIPを割り当てる)

2. Eclipseにて、パースペクティブを「SVNリポジトリエクスプローラー」に設定する

3. 画面左側のパッケージエクスプローラ上部の「新規リポジトリーロケーション」アイコンをクリックする

4. ダイアログにて、以下を入力し、完了ボタンを押す  

    * URL  
        SVNリポジトリのURLを入力する  
    * 認証  
        SVNアカウントのユーザ名とパスワードを入力する  

5. ツリーより、以下のフォルダを右クリックし、「チェックアウト」を選択する  

    * OZ  
    * OZlib  

6. チェックアウト後、パースペクティブをJavaにする  
   画面左側のナビゲータにチェックアウトしたプロジェクトが表示されていることを確認する

7. AWS SDKをインストールする  

    7.1 「ヘルプ > 新規ソフトウェアのインストール」より、AWS SDKをダウンロードする

    * 更新サイトに以下を選択する  
        http://aws.amazon.com/jp/eclipse  
    * 以下のモジュールを選択する  
        * AWS Core Management Tools
        * AWS Deployment Tools/ AWS Lambda Plugin  

* メモ

    ```
    一旦AWSアクセスキー等の入力は無視してOK  
    ソースコード(クラスファイル)は$HOME/aws-java-sdkにインストールされる  
    ```

### プロジェクトの設定

1. Java7でコンパイルする設定にする  

    OZ > プロパティ > Javaコンパイラーより、コンパイラーの準拠レベルを1.7にする  

2. プロジェクトのビルドパスを設定する
   
   OZプロジェクトを右クリックし、「プロパティ > Javaのビルドパス」を選択する   

   * ライブラリ  
      * デフォルトで設定されているant.jarからxmlbeansまでを除去する  
      * 「外部jarの追加」より、OZ/lib内のjarファイルを選択する  
      * JREシステムライブラリに1.7が選択されていることを確認する。選択されていない場合は、1.7を選択する  
      * Java AWS SDKを追加する  
   * ソース  
      * デフォルトで設定されているresourcesを除去する  
      * チェックアウトしたOZプロジェクトのresourcesを追加する  
      * OZlib/srcを追加する  
      * OZlib/resourceを追加する  

* メモ  

  OZプロジェクト配下の .classpath を修正すれば、上記の幾つかの手順は不要になるので、後々対応したい。

## OZ  

### 出力ディレクトリ作成  

ドライブ直下(ルート直下)に以下のディレクトリとファイルを作成する  

```
	oz/
		oz.ini
		ozCrawler/
			RNN.ini
			RNN.lst
		ozScraper/
			RNN-TC.ini
			RNN-TC.lst
	ebs/
```

### クロールする  

1. OzCrawlerのmainメソッドをエクリプス上で実行する。  
   その際、mainメソッド内の記載を以下のように変更する。

   ```java
	args = new String[] {"RNN"};
   ```

2. htmlファイルが出力されることを確認する。

### スクレイプする  

1. ebs/oz/～～～～～より、htmlファイルが出力されたディレクトリ名を確認する  
   このディレクトリ名がジョブIDとなる。 (例)

2. OzScraperのmainメソッドをエクリプス上で実行する。  
   その際、mainメソッド内の記載を以下のように変更する。  

   ```java
	args = new String[2];
	args[0] ="RNN-TC";
	args[1] ="ジョブのID";
   ```
